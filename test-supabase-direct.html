<!DOCTYPE html>
<html>
<head>
    <title>Direct Supabase Test</title>
</head>
<body>
    <h1>Direct Supabase Headers Test</h1>
    <div id="output"></div>

    <script type="module">
        // Test exact Supabase headers pattern
        const output = document.getElementById('output');

        const url = "https://nktdqpzxzouxcsvmijvt.supabase.co";
        const key = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rdGRxcHp4em91eGNzdm1panZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyNzQ0MjMsImV4cCI6MjA3Mjg1MDQyM30.9-wSc9vwUOvWPzQl88mxIT0RwgVDm20GUedP9enI3Jk";

        output.innerHTML += `<p><strong>URL:</strong> ${url}</p>`;
        output.innerHTML += `<p><strong>Key Length:</strong> ${key.length}</p>`;
        output.innerHTML += `<p><strong>Key Preview:</strong> ${key.substring(0, 50)}...</p>`;

        // Test exact headers that Supabase uses
        const testHeaders = [
            ['Authorization', `Bearer ${key}`],
            ['apikey', key],
            ['Content-Type', 'application/json'],
            ['Prefer', 'return=minimal']
        ];

        output.innerHTML += '<h2>Header Tests:</h2>';

        testHeaders.forEach(([name, value], i) => {
            try {
                const headers = new Headers();
                headers.set(name, value);
                output.innerHTML += `<p style="color: green;">‚úÖ ${name}: OK</p>`;
            } catch (error) {
                output.innerHTML += `<p style="color: red;">‚ùå ${name}: FAILED - ${error.message}</p>`;
            }
        });

        // Test actual fetch to Supabase
        output.innerHTML += '<h2>Fetch Test:</h2>';

        try {
            const headers = {
                'Authorization': `Bearer ${key}`,
                'apikey': key,
                'Content-Type': 'application/json'
            };

            output.innerHTML += '<p>üîÑ Testing fetch...</p>';

            fetch(`${url}/rest/v1/`, {
                method: 'GET',
                headers: headers
            })
            .then(response => {
                output.innerHTML += `<p style="color: green;">‚úÖ Fetch successful: ${response.status}</p>`;
            })
            .catch(error => {
                output.innerHTML += `<p style="color: red;">‚ùå Fetch failed: ${error.message}</p>`;
            });

        } catch (error) {
            output.innerHTML += `<p style="color: red;">‚ùå Fetch setup failed: ${error.message}</p>`;
        }
    </script>
</body>
</html>